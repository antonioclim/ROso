#!/bin/bash
# =============================================================================
# SYSBACKUP - Enterprise Backup System Wrapper
# =============================================================================
# Wrapper pentru instalare în /usr/local/bin
# Rezolvă automat calea către scriptul principal
#
# Instalare:
#   sudo ln -s /path/to/backup/bin/sysbackup /usr/local/bin/sysbackup
#
# =============================================================================

set -euo pipefail

# Rezolvă symlink-uri pentru a găsi directorul real
get_script_dir() {
    local source="${BASH_SOURCE[0]}"
    local dir
    
    # Rezolvă symlink-uri
    while [[ -L "$source" ]]; do
        dir="$(cd -P "$(dirname "$source")" && pwd)"
        source="$(readlink "$source")"
        [[ "$source" != /* ]] && source="$dir/$source"
    done
    
    dir="$(cd -P "$(dirname "$source")" && pwd)"
    echo "$dir"
}

# Găsește directorul scriptului
SCRIPT_DIR="$(get_script_dir)"

# Calculează directorul proiectului (un nivel mai sus de bin/)
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"

# Scriptul principal
MAIN_SCRIPT="${PROJECT_DIR}/backup.sh"

# Verifică că scriptul principal există
if [[ ! -f "$MAIN_SCRIPT" ]]; then
    echo "EROARE: Nu găsesc scriptul principal: $MAIN_SCRIPT" >&2
    echo "Verifică instalarea sistemului de backup." >&2
    exit 1
fi

# Verifică că e executabil
if [[ ! -x "$MAIN_SCRIPT" ]]; then
    echo "EROARE: Scriptul principal nu este executabil: $MAIN_SCRIPT" >&2
    echo "Rulează: chmod +x $MAIN_SCRIPT" >&2
    exit 1
fi

# Execută scriptul principal cu toate argumentele
exec "$MAIN_SCRIPT" "$@"
