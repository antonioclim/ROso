@startuml
!theme plain
skinparam backgroundColor #FEFEFE
skinparam defaultFontName DejaVu Sans
skinparam defaultFontSize 10

title Modelul Capabilities vs. SUID Tradițional
caption Curs 13: Securitate în Sisteme de Operare — Principiul Privilegiului Minim

left to right direction

package "**Model Tradițional (SUID root)**" as TRAD #MistyRose {
  actor "User normal\n(uid=1000)" as U1
  
  rectangle "ping\n-rwsr-xr-x\nowner: root" as PING1 #LightCoral
  
  rectangle "**Toate privilegiile root**\n• CAP_NET_RAW\n• CAP_SYS_ADMIN\n• CAP_DAC_OVERRIDE\n• CAP_KILL\n• ... (38+ capabilities)" as ROOT1 #Red
  
  U1 -right-> PING1 : "execută"
  PING1 -right-> ROOT1 : "EUID=0\n**PERICOL!**"
  
  note bottom of ROOT1
    **Problema:**
    Dacă ping are vulnerabilitate
    → atacatorul obține **root complet**
  end note
}

package "**Model Capabilities (modern)**" as CAP #Honeydew {
  actor "User normal\n(uid=1000)" as U2
  
  rectangle "ping\n-rwxr-xr-x\n+cap_net_raw" as PING2 #LightGreen
  
  rectangle "**Doar CAP_NET_RAW**\n(raw sockets pentru ICMP)" as ROOT2 #Green
  
  U2 -right-> PING2 : "execută"
  PING2 -right-> ROOT2 : "Privilegiu\n**MINIM**"
  
  note bottom of ROOT2
    **Avantaj:**
    Dacă ping are vulnerabilitate
    → atacatorul obține **doar** net_raw
    → NU poate citi /etc/shadow
    → NU poate instala rootkit
  end note
}

note right of CAP
  **Capabilities Linux comune:**
  
  | Capability | Permite |
  |------------|---------|
  | CAP_NET_RAW | raw sockets |
  | CAP_NET_BIND_SERVICE | bind port <1024 |
  | CAP_SYS_PTRACE | strace/gdb |
  | CAP_DAC_READ_SEARCH | bypass read perms |
  | CAP_SETUID | change UID |
  | CAP_SYS_ADMIN | catch-all admin |
  
  **Setare capability:**
  sudo setcap cap_net_raw+ep /usr/bin/ping
  
  **Verificare:**
  getcap /usr/bin/ping
end note

rectangle "**Ierarhia Privilegiilor**" as HIER #LightBlue {
  rectangle "root (UID 0)\nToate capabilities" as R #Red
  rectangle "Capabilities specifice\n(granulare)" as C #Yellow
  rectangle "User normal\n(fără privilegii extra)" as N #Green
  
  R -down-> C : "Principiul\nprivilegiului\nminim"
  C -down-> N
}

@enduml
