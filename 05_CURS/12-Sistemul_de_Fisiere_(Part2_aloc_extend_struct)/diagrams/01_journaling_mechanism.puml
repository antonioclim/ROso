
@startuml journaling_mechanism
!include ../../diagrams_common/skin.puml
title Journaling Mechanism (ext4)

skinparam activity {
    DiamondBackgroundColor #FFF9C4
}

|Application|
start
:Write new data;

|Kernel / FS|
:1. **TXB** (Transaction Begin)
Write to journal;

:2. Write **metadata + data**
to journal;

:3. **TXE** (Transaction End)
Mark transaction as complete;

:4. **Checkpoint**
Write data to final location;

:5. Delete transaction
from journal;

|Disk|
:Data saved!;
stop

legend right
**On CRASH / Power Failure:**

**Scenario 1:** Crash before TXE
→ Incomplete transaction → **Ignore**

**Scenario 2:** Crash after TXE
→ Complete transaction → **Replay**

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

**ext4 Modes:**
|= Mode |= What is journaled |= Speed |
| journal | Metadata + Data | Slow |
| **ordered** | Metadata (default) | Medium |
| writeback | Metadata only | Fast |
endlegend

@enduml
