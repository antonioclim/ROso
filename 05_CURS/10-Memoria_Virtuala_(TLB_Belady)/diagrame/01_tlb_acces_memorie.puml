@startuml tlb_acces_memorie
!include ../../diagrame_common/skin.puml
title TLB (Translation Lookaside Buffer)

skinparam activity {
    DiamondBackgroundColor #FFF9C4
}

start

:CPU generează
**Adresa Virtuală**;

:Extrage **Page Number**;

if (Căutare în\n**TLB**?) then (HIT ~98%)
    #C8E6C9:Frame# găsit direct!;
    :Acces memorie: **1×**;
else (MISS ~2%)
    #FFCDD2:Consultă **Page Table**
    (poate fi 2-4 niveluri);
    :Accese memorie: **2-4×**;
    
    if (Pagina validă?) then (Da)
        :Actualizează TLB;
    else (Nu - Page Fault)
        #FFE0B2:Întrerupere kernel
        Încarcă pagina de pe disc;
        :Actualizează Page Table;
        :Actualizează TLB;
    endif
endif

:Formează **Adresa Fizică**
Frame# + Offset;

:Accesează **Memoria Fizică**;

stop

legend right
**Calcul EAT (Effective Access Time)**
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
α = TLB hit rate (ex: 98%)
ε = TLB access (ex: 1 ns)
m = Memory access (ex: 100 ns)

**EAT = α(ε+m) + (1-α)(ε+2m)**

Exemplu:
0.98×(1+100) + 0.02×(1+200)
= 98.98 + 4.02 = **103 ns**

Fără TLB: 200 ns
Cu TLB: 103 ns → **49% mai rapid!**
endlegend

@enduml
