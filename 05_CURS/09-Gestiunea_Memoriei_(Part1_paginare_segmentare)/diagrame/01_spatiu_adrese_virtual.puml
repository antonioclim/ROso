@startuml spatiu_adrese_virtual
!include ../../diagrame_common/skin.puml
title Spațiul de Adrese Virtual (64-bit Linux)

skinparam rectangle {
    roundCorner 3
}

rectangle "**SPAȚIU DE ADRESE VIRTUAL**" as vas #FAFAFA {
    
    rectangle "0xFFFFFFFF...\n**KERNEL SPACE**\n~128 TB" as kernel #FFE0B2 {
        note right
        • Cod kernel
        • Drivere
        • Page tables
        end note
    }
    
    rectangle "**NON-CANONICAL GAP**\n(adrese invalide)\nAcces → SEGFAULT" as gap #FFCDD2
    
    rectangle "**USER SPACE** ~128 TB" as user #E3F2FD {
        
        rectangle "**STACK** ↓\n~8 MB default" as stack #FFCDD2 {
            note right
            Variabile locale
            Parametri funcții
            Adrese return
            end note
        }
        
        rectangle "⬇️ crește în jos" as arrow1 #FFFFFF
        
        rectangle "**MEMORY MAPPED**\nBiblioteci .so\nmmap() regions" as mmap #E1BEE7
        
        rectangle "⬆️ crește în sus" as arrow2 #FFFFFF
        
        rectangle "**HEAP** ↑\nmalloc(), new" as heap #FFF9C4 {
            note right
            Alocare dinamică
            brk() extinde
            end note
        }
        
        rectangle "**BSS**\nVar. globale neinit.\n(zeroed)" as bss #C8E6C9
        
        rectangle "**DATA**\nVar. globale init." as data #C8E6C9
        
        rectangle "**TEXT (CODE)**\nRead-only, Exec" as text #BBDEFB {
            note right
            Instrucțiuni
            Partajat la fork
            end note
        }
        
        rectangle "0x00000000\n**RESERVED**\nNULL region" as null #ECEFF1
    }
}

kernel -[hidden]down-> gap
gap -[hidden]down-> user

note bottom of vas
**Vizualizare Linux:** cat /proc/PID/maps
Fiecare proces are propriul spațiu virtual!
end note

@enduml
