@startuml
!theme plain
skinparam backgroundColor #FEFEFE
skinparam defaultFontName DejaVu Sans
skinparam defaultFontSize 11

title Operațiile Semaforului: wait() și signal()
caption Curs 7: Sincronizare Part 2 — Semafoare

rectangle "**Semafor S**\n(contor întreg ≥ 0)" as S #LightBlue {
  rectangle "Valoare: n" as val #White
}

rectangle "Thread T1\n(vrea resursă)" as T1 #LightGreen
rectangle "Thread T2\n(eliberează)" as T2 #LightCoral
rectangle "Coada de\nașteptare" as Q #LightYellow

T1 -down-> S : **wait(S)** / P(S) / down(S)
note right of T1
  **Pseudocod wait(S):**
  atomic {
    while (S <= 0) {
      // adaugă thread în coadă
      // blochează thread
    }
    S = S - 1;
  }
end note

S -down-> Q : "dacă S ≤ 0\nThread → Coadă\n(blocat)"

T2 -down-> S : **signal(S)** / V(S) / up(S)
note left of T2
  **Pseudocod signal(S):**
  atomic {
    S = S + 1;
    if (threads în coadă) {
      // trezește un thread
    }
  }
end note

Q -up-> S : "signal() trezește\nun thread din coadă"

note bottom of S
  **Invariant matematic:**
  S = S₀ - #wait_completate + #signal_completate
  
  **Semafor binar:** S ∈ {0, 1} (echivalent mutex)
  **Semafor numărare:** S ∈ {0, 1, 2, ...} (resurse multiple)
end note

note bottom of Q
  **Implementare coadă:**
  - FIFO: garantează bounded waiting
  - LIFO: posibilă starvation
  
  **Atomicitate:**
  - Dezactivare întreruperi (uniprocesor)
  - Spinlock + dezactivare (SMP)
end note

@enduml
