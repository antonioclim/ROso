@startuml producator_consumator
!include ../../diagrame_common/skin.puml
title Producător-Consumator cu Semafoare

skinparam rectangle {
    roundCorner 8
}

rectangle "**BUFFER BOUNDED (N=5)**" as system #FAFAFA {
    
    rectangle "**Producător**" as producer #C8E6C9 {
        note as prod_code
        **Pseudocod:**
        ──────────────
        wait(empty)  // slot liber?
        wait(mutex)  // intră CS
        buffer[in] = item
        in = (in+1) % N
        signal(mutex)
        signal(full) // anunță element
        end note
    }
    
    rectangle "**Buffer Circular**" as buffer #FFF9C4 {
        rectangle "0" as b0 #FFFFFF
        rectangle "1" as b1 #FFFFFF
        rectangle "2" as b2 #FFFFFF
        rectangle "3" as b3 #FFFFFF
        rectangle "4" as b4 #FFFFFF
        
        note bottom of buffer
        **in** → unde pune producătorul
        **out** → de unde ia consumatorul
        end note
    }
    
    rectangle "**Consumator**" as consumer #E3F2FD {
        note as cons_code
        **Pseudocod:**
        ──────────────
        wait(full)   // element disponibil?
        wait(mutex)  // intră CS
        item = buffer[out]
        out = (out+1) % N
        signal(mutex)
        signal(empty) // anunță slot liber
        end note
    }
    
    producer -[#27AE60,bold]-> buffer : produce
    buffer -[#3498DB,bold]-> consumer : consume
}

rectangle "**SEMAFOARE**" as sems #FCE4EC {
    rectangle "**empty = N**\n(sloturi goale)" as empty #C8E6C9
    rectangle "**full = 0**\n(elemente disponibile)" as full #E3F2FD
    rectangle "**mutex = 1**\n(acces exclusiv buffer)" as mutex #FFF9C4
}

note bottom of system
⚠️ **ORDINEA CORECTĂ a wait():**
1. wait(empty/full) - verifică disponibilitate
2. wait(mutex) - ia lock-ul

**GREȘIT**: wait(mutex) apoi wait(empty) → **DEADLOCK!**
end note

@enduml
