<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allocation Methods Comparator - Sisteme de Operare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Rubik:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Rubik', sans-serif;
            background: linear-gradient(135deg, #0a0a12 0%, #12121f 50%, #0a0a12 100%);
            min-height: 100vh;
        }
        
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.06);
        }
        
        .method-tab {
            transition: all 0.3s ease;
        }
        
        .method-tab.active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3) 0%, rgba(139, 92, 246, 0.3) 100%);
            border-color: rgba(99, 102, 241, 0.5);
        }
        
        .disk-block {
            width: 40px;
            height: 40px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .disk-block:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .disk-block.empty {
            background: linear-gradient(145deg, #1f2937 0%, #111827 100%);
            border: 1px solid #374151;
        }
        
        .disk-block.file-a {
            background: linear-gradient(145deg, #3b82f6 0%, #1d4ed8 100%);
            border: 1px solid #60a5fa;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }
        
        .disk-block.file-b {
            background: linear-gradient(145deg, #22c55e 0%, #16a34a 100%);
            border: 1px solid #4ade80;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
        }
        
        .disk-block.file-c {
            background: linear-gradient(145deg, #f59e0b 0%, #d97706 100%);
            border: 1px solid #fbbf24;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
        }
        
        .disk-block.index {
            background: linear-gradient(145deg, #a855f7 0%, #7c3aed 100%);
            border: 1px solid #c084fc;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.3);
        }
        
        .disk-block.pointer {
            position: relative;
        }
        
        .disk-block.pointer::after {
            content: '→';
            position: absolute;
            right: 2px;
            bottom: 0;
            font-size: 10px;
            color: white;
        }
        
        .allocation-animation {
            animation: allocate 0.3s ease-out;
        }
        
        @keyframes allocate {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .fragment-warning {
            animation: fragmentPulse 2s ease-in-out infinite;
        }
        
        @keyframes fragmentPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .arrow-connection {
            stroke-dasharray: 4, 2;
            animation: flowArrow 1s linear infinite;
        }

        @keyframes flowArrow {
            to { stroke-dashoffset: -6; }
        }

        .directory-entry {
            transition: all 0.2s ease;
        }

        .directory-entry:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }
    </style>
</head>
<body class="text-white p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold mb-2 bg-gradient-to-r from-blue-400 via-purple-400 to-amber-400 bg-clip-text text-transparent">
                <i class="fas fa-th mr-3"></i>Disk Allocation Methods
            </h1>
            <p class="text-gray-400 text-lg">Contiguous vs Linked vs Indexed Allocation</p>
        </header>

        <!-- Method Tabs -->
        <div class="flex flex-wrap justify-center gap-2 mb-6">
            <button onclick="showMethod('contiguous')" id="tab-contiguous" class="method-tab active px-5 py-3 rounded-xl border border-gray-700 transition flex items-center gap-2">
                <div class="w-4 h-4 rounded bg-gradient-to-r from-blue-500 to-cyan-500"></div>
                <span class="font-semibold">Contiguous</span>
            </button>
            <button onclick="showMethod('linked')" id="tab-linked" class="method-tab px-5 py-3 rounded-xl border border-gray-700 transition flex items-center gap-2">
                <div class="w-4 h-4 rounded bg-gradient-to-r from-green-500 to-emerald-500"></div>
                <span class="font-semibold">Linked</span>
            </button>
            <button onclick="showMethod('indexed')" id="tab-indexed" class="method-tab px-5 py-3 rounded-xl border border-gray-700 transition flex items-center gap-2">
                <div class="w-4 h-4 rounded bg-gradient-to-r from-purple-500 to-pink-500"></div>
                <span class="font-semibold">Indexed</span>
            </button>
        </div>

        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Left: Disk Visualization -->
            <div class="lg:col-span-2">
                <div class="glass-card rounded-2xl p-5">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold flex items-center">
                            <i class="fas fa-hdd mr-2 text-blue-400"></i>Disk Blocks
                        </h3>
                        <div class="text-sm text-gray-400">
                            <span id="used-blocks">0</span>/<span id="total-blocks">32</span> blocks used
                        </div>
                    </div>
                    
                    <!-- Disk Grid -->
                    <div id="disk-grid" class="grid grid-cols-8 gap-1 mb-4">
                        <!-- Generated by JS -->
                    </div>
                    
                    <!-- Legend -->
                    <div class="flex flex-wrap gap-4 text-sm">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded disk-block empty"></div>
                            <span class="text-gray-400">Empty</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded disk-block file-a"></div>
                            <span class="text-gray-400">File A</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded disk-block file-b"></div>
                            <span class="text-gray-400">File B</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded disk-block file-c"></div>
                            <span class="text-gray-400">File C</span>
                        </div>
                        <div id="legend-index" class="flex items-center gap-2 hidden">
                            <div class="w-4 h-4 rounded disk-block index"></div>
                            <span class="text-gray-400">Index Block</span>
                        </div>
                    </div>
                </div>
                
                <!-- Directory Table -->
                <div class="glass-card rounded-2xl p-5 mt-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-folder mr-2 text-amber-400"></i>Directory Entry Table
                    </h3>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="text-left py-2 px-3">File Name</th>
                                    <th class="text-center py-2 px-3" id="dir-col-2">Start Block</th>
                                    <th class="text-center py-2 px-3" id="dir-col-3">Length</th>
                                    <th class="text-center py-2 px-3">Size</th>
                                </tr>
                            </thead>
                            <tbody id="directory-table">
                                <!-- Generated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Method Explanation -->
                <div id="method-explanation" class="glass-card rounded-2xl p-5 mt-6">
                    <!-- Content set by JS -->
                </div>
            </div>

            <!-- Right: Controls & Info -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Operations -->
                <div class="glass-card rounded-2xl p-5">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-cogs mr-2 text-green-400"></i>Operații
                    </h3>
                    
                    <!-- Create File -->
                    <div class="mb-4">
                        <label class="text-sm text-gray-400 mb-2 block">Creează Fișier</label>
                        <div class="flex gap-2">
                            <select id="new-file-name" class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm">
                                <option value="A">File A</option>
                                <option value="B">File B</option>
                                <option value="C">File C</option>
                            </select>
                            <input type="number" id="new-file-size" min="1" max="10" value="3" class="w-20 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm" placeholder="Size">
                            <button onclick="createFile()" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg transition">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Delete File -->
                    <div class="mb-4">
                        <label class="text-sm text-gray-400 mb-2 block">Șterge Fișier</label>
                        <div class="flex gap-2">
                            <select id="delete-file-name" class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm">
                                <option value="A">File A</option>
                                <option value="B">File B</option>
                                <option value="C">File C</option>
                            </select>
                            <button onclick="deleteFile()" class="px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Extend File -->
                    <div class="mb-4">
                        <label class="text-sm text-gray-400 mb-2 block">Extinde Fișier</label>
                        <div class="flex gap-2">
                            <select id="extend-file-name" class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm">
                                <option value="A">File A</option>
                                <option value="B">File B</option>
                                <option value="C">File C</option>
                            </select>
                            <input type="number" id="extend-size" min="1" max="5" value="2" class="w-20 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm" placeholder="+">
                            <button onclick="extendFile()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg transition">
                                <i class="fas fa-expand-arrows-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button onclick="resetDisk()" class="w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">
                        <i class="fas fa-redo mr-2"></i>Reset Disk
                    </button>
                </div>
                
                <!-- Status/Warnings -->
                <div class="glass-card rounded-2xl p-5">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-cyan-400"></i>Status
                    </h3>
                    <div id="status-log" class="space-y-2 text-sm max-h-40 overflow-y-auto">
                        <div class="text-gray-500">Selectează o metodă și creează fișiere...</div>
                    </div>
                </div>
                
                <!-- Comparison Quick View -->
                <div class="glass-card rounded-2xl p-5">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-balance-scale mr-2 text-purple-400"></i>Comparație Rapidă
                    </h3>
                    
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Fragmentare Externă</span>
                            <div id="cmp-fragmentation" class="text-right">
                                <span class="text-red-400">Contiguous</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Acces Secvențial</span>
                            <div id="cmp-sequential">
                                <span class="text-green-400">Contiguous</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Acces Random</span>
                            <div id="cmp-random">
                                <span class="text-green-400">Indexed</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Extensibilitate</span>
                            <div id="cmp-extend">
                                <span class="text-green-400">Linked/Indexed</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Comparison Table -->
        <div class="glass-card rounded-2xl p-5 mt-6">
            <h3 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-table mr-2 text-amber-400"></i>Comparație Detaliată
            </h3>
            
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-gray-700">
                            <th class="text-left py-3 px-4">Aspect</th>
                            <th class="text-center py-3 px-4 text-blue-400">Contiguous</th>
                            <th class="text-center py-3 px-4 text-green-400">Linked</th>
                            <th class="text-center py-3 px-4 text-purple-400">Indexed</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-gray-800">
                            <td class="py-3 px-4 font-medium">Directory Entry</td>
                            <td class="text-center py-3 px-4 mono text-xs">(start, length)</td>
                            <td class="text-center py-3 px-4 mono text-xs">(first, last)</td>
                            <td class="text-center py-3 px-4 mono text-xs">(index_block)</td>
                        </tr>
                        <tr class="border-b border-gray-800">
                            <td class="py-3 px-4 font-medium">Fragmentare Externă</td>
                            <td class="text-center py-3 px-4"><span class="px-2 py-1 bg-red-900/30 text-red-400 rounded">Severă</span></td>
                            <td class="text-center py-3 px-4"><span class="px-2 py-1 bg-green-900/30 text-green-400 rounded">Nu</span></td>
                            <td class="text-center py-3 px-4"><span class="px-2 py-1 bg-green-900/30 text-green-400 rounded">Nu</span></td>
                        </tr>
                        <tr class="border-b border-gray-800">
                            <td class="py-3 px-4 font-medium">Acces Secvențial</td>
                            <td class="text-center py-3 px-4"><span class="text-green-400">★★★</span></td>
                            <td class="text-center py-3 px-4"><span class="text-yellow-400">★★☆</span></td>
                            <td class="text-center py-3 px-4"><span class="text-yellow-400">★★☆</span></td>
                        </tr>
                        <tr class="border-b border-gray-800">
                            <td class="py-3 px-4 font-medium">Acces Random</td>
                            <td class="text-center py-3 px-4"><span class="text-green-400">★★★</span></td>
                            <td class="text-center py-3 px-4"><span class="text-red-400">★☆☆</span></td>
                            <td class="text-center py-3 px-4"><span class="text-green-400">★★★</span></td>
                        </tr>
                        <tr class="border-b border-gray-800">
                            <td class="py-3 px-4 font-medium">Extindere Fișier</td>
                            <td class="text-center py-3 px-4"><span class="text-red-400">Dificilă</span></td>
                            <td class="text-center py-3 px-4"><span class="text-green-400">Ușoară</span></td>
                            <td class="text-center py-3 px-4"><span class="text-green-400">Ușoară</span></td>
                        </tr>
                        <tr class="border-b border-gray-800">
                            <td class="py-3 px-4 font-medium">Overhead</td>
                            <td class="text-center py-3 px-4"><span class="text-green-400">Minim</span></td>
                            <td class="text-center py-3 px-4"><span class="text-yellow-400">Pointeri în blocuri</span></td>
                            <td class="text-center py-3 px-4"><span class="text-yellow-400">Index block(s)</span></td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-medium">Utilizare Tipică</td>
                            <td class="text-center py-3 px-4 text-xs">CD-ROM, DVD</td>
                            <td class="text-center py-3 px-4 text-xs">FAT (mai vechi)</td>
                            <td class="text-center py-3 px-4 text-xs">UNIX (inode)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-6 text-center text-gray-500 text-sm py-4 border-t border-gray-700">
            <p>By Revolvix, limited licence 2019-2030 | ASE-CSIE Bucharest</p>
        </footer>
    </div>

    <script>
        // Constants
        const TOTAL_BLOCKS = 32;
        const BLOCK_SIZE = 4096; // 4KB
        
        // State
        let currentMethod = 'contiguous';
        let diskBlocks = new Array(TOTAL_BLOCKS).fill(null);
        let files = {};
        
        // Method explanations
        const methodExplanations = {
            contiguous: `
                <h4 class="text-lg font-bold text-blue-400 mb-3"><i class="fas fa-arrow-right mr-2"></i>Contiguous Allocation</h4>
                <p class="text-gray-300 mb-3">Fiecare fișier ocupă un set de <strong>blocuri consecutive</strong> pe disk.</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-green-900/20 border border-green-500/30 rounded-xl p-3">
                        <div class="text-green-400 font-semibold mb-2"><i class="fas fa-check mr-1"></i> Avantaje</div>
                        <ul class="text-sm text-gray-400 space-y-1">
                            <li>• Acces secvențial foarte rapid</li>
                            <li>• Acces random eficient (start + offset)</li>
                            <li>• Directory entry simplu</li>
                        </ul>
                    </div>
                    <div class="bg-red-900/20 border border-red-500/30 rounded-xl p-3">
                        <div class="text-red-400 font-semibold mb-2"><i class="fas fa-times mr-1"></i> Dezavantaje</div>
                        <ul class="text-sm text-gray-400 space-y-1">
                            <li>• Fragmentare externă severă</li>
                            <li>• Extinderea fișierelor e problematică</li>
                            <li>• Necesită compactare periodică</li>
                        </ul>
                    </div>
                </div>
            `,
            linked: `
                <h4 class="text-lg font-bold text-green-400 mb-3"><i class="fas fa-link mr-2"></i>Linked Allocation</h4>
                <p class="text-gray-300 mb-3">Fiecare bloc conține un <strong>pointer</strong> către următorul bloc al fișierului.</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-green-900/20 border border-green-500/30 rounded-xl p-3">
                        <div class="text-green-400 font-semibold mb-2"><i class="fas fa-check mr-1"></i> Avantaje</div>
                        <ul class="text-sm text-gray-400 space-y-1">
                            <li>• Fără fragmentare externă</li>
                            <li>• Extindere ușoară</li>
                            <li>• Orice bloc liber poate fi folosit</li>
                        </ul>
                    </div>
                    <div class="bg-red-900/20 border border-red-500/30 rounded-xl p-3">
                        <div class="text-red-400 font-semibold mb-2"><i class="fas fa-times mr-1"></i> Dezavantaje</div>
                        <ul class="text-sm text-gray-400 space-y-1">
                            <li>• Acces random lent (traversare)</li>
                            <li>• Overhead pointeri în fiecare bloc</li>
                            <li>• Vulnerabil la corupție (un pointer rupt = pierdere date)</li>
                        </ul>
                    </div>
                </div>
            `,
            indexed: `
                <h4 class="text-lg font-bold text-purple-400 mb-3"><i class="fas fa-list-ol mr-2"></i>Indexed Allocation</h4>
                <p class="text-gray-300 mb-3">Un <strong>index block</strong> separat conține toți pointerii la blocurile de date.</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-green-900/20 border border-green-500/30 rounded-xl p-3">
                        <div class="text-green-400 font-semibold mb-2"><i class="fas fa-check mr-1"></i> Avantaje</div>
                        <ul class="text-sm text-gray-400 space-y-1">
                            <li>• Acces random rapid</li>
                            <li>• Fără fragmentare externă</li>
                            <li>• Similar cu inode-urile UNIX</li>
                        </ul>
                    </div>
                    <div class="bg-red-900/20 border border-red-500/30 rounded-xl p-3">
                        <div class="text-red-400 font-semibold mb-2"><i class="fas fa-times mr-1"></i> Dezavantaje</div>
                        <ul class="text-sm text-gray-400 space-y-1">
                            <li>• Overhead pentru index block</li>
                            <li>• Pentru fișiere mari: indirect blocks</li>
                            <li>• Wasted space pentru fișiere mici</li>
                        </ul>
                    </div>
                </div>
            `
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initDiskGrid();
            showMethod('contiguous');
        });
        
        // Initialize disk grid
        function initDiskGrid() {
            const grid = document.getElementById('disk-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < TOTAL_BLOCKS; i++) {
                const block = document.createElement('div');
                block.id = `block-${i}`;
                block.className = 'disk-block empty rounded flex items-center justify-center text-xs font-bold';
                block.textContent = i;
                block.onclick = () => showBlockInfo(i);
                grid.appendChild(block);
            }
        }
        
        // Show method
        function showMethod(method) {
            currentMethod = method;
            
            // Update tabs
            document.querySelectorAll('.method-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`tab-${method}`).classList.add('active');
            
            // Update directory table headers
            if (method === 'contiguous') {
                document.getElementById('dir-col-2').textContent = 'Start Block';
                document.getElementById('dir-col-3').textContent = 'Length';
            } else if (method === 'linked') {
                document.getElementById('dir-col-2').textContent = 'First Block';
                document.getElementById('dir-col-3').textContent = 'Last Block';
            } else {
                document.getElementById('dir-col-2').textContent = 'Index Block';
                document.getElementById('dir-col-3').textContent = 'Blocks';
            }
            
            // Show/hide index legend
            document.getElementById('legend-index').classList.toggle('hidden', method !== 'indexed');
            
            // Update explanation
            document.getElementById('method-explanation').innerHTML = methodExplanations[method];
            
            // Reset and redraw
            resetDisk();
        }
        
        // Create file
        function createFile() {
            const name = document.getElementById('new-file-name').value;
            const size = parseInt(document.getElementById('new-file-size').value);
            
            if (files[name]) {
                logStatus(`Fișierul ${name} există deja!`, 'error');
                return;
            }
            
            const result = allocateBlocks(name, size);
            if (result.success) {
                files[name] = result.fileInfo;
                updateDiskDisplay();
                updateDirectoryTable();
                logStatus(`Fișier ${name} creat (${size} blocuri)`, 'success');
            } else {
                logStatus(result.message, 'error');
            }
        }
        
        // Allocate blocks based on method
        function allocateBlocks(name, size) {
            const fileClass = `file-${name.toLowerCase()}`;
            
            if (currentMethod === 'contiguous') {
                // Find contiguous free space
                let start = -1;
                let count = 0;
                
                for (let i = 0; i < TOTAL_BLOCKS; i++) {
                    if (diskBlocks[i] === null) {
                        if (start === -1) start = i;
                        count++;
                        if (count === size) {
                            // Allocate
                            for (let j = start; j < start + size; j++) {
                                diskBlocks[j] = { file: name, class: fileClass };
                            }
                            return {
                                success: true,
                                fileInfo: { start, length: size, blocks: Array.from({length: size}, (_, i) => start + i) }
                            };
                        }
                    } else {
                        start = -1;
                        count = 0;
                    }
                }
                
                return { success: false, message: `Nu există ${size} blocuri contigue libere! (Fragmentare externă)` };
                
            } else if (currentMethod === 'linked') {
                // Find any free blocks
                const freeBlocks = [];
                for (let i = 0; i < TOTAL_BLOCKS; i++) {
                    if (diskBlocks[i] === null) freeBlocks.push(i);
                    if (freeBlocks.length === size) break;
                }
                
                if (freeBlocks.length < size) {
                    return { success: false, message: `Nu există ${size} blocuri libere!` };
                }
                
                // Allocate with pointers
                for (let i = 0; i < freeBlocks.length; i++) {
                    const blockIdx = freeBlocks[i];
                    const nextBlock = i < freeBlocks.length - 1 ? freeBlocks[i + 1] : null;
                    diskBlocks[blockIdx] = { 
                        file: name, 
                        class: fileClass, 
                        next: nextBlock,
                        isPointer: true
                    };
                }
                
                return {
                    success: true,
                    fileInfo: { 
                        first: freeBlocks[0], 
                        last: freeBlocks[freeBlocks.length - 1],
                        blocks: freeBlocks
                    }
                };
                
            } else { // indexed
                // Need 1 index block + size data blocks
                const freeBlocks = [];
                for (let i = 0; i < TOTAL_BLOCKS; i++) {
                    if (diskBlocks[i] === null) freeBlocks.push(i);
                    if (freeBlocks.length === size + 1) break;
                }
                
                if (freeBlocks.length < size + 1) {
                    return { success: false, message: `Nu există ${size + 1} blocuri libere (1 index + ${size} date)!` };
                }
                
                // First block is index
                const indexBlock = freeBlocks[0];
                const dataBlocks = freeBlocks.slice(1);
                
                diskBlocks[indexBlock] = { 
                    file: name, 
                    class: 'index',
                    isIndex: true,
                    pointers: dataBlocks
                };
                
                for (const blockIdx of dataBlocks) {
                    diskBlocks[blockIdx] = { file: name, class: fileClass };
                }
                
                return {
                    success: true,
                    fileInfo: {
                        indexBlock,
                        blocks: dataBlocks,
                        allBlocks: freeBlocks
                    }
                };
            }
        }
        
        // Delete file
        function deleteFile() {
            const name = document.getElementById('delete-file-name').value;
            
            if (!files[name]) {
                logStatus(`Fișierul ${name} nu există!`, 'error');
                return;
            }
            
            // Free blocks
            for (let i = 0; i < TOTAL_BLOCKS; i++) {
                if (diskBlocks[i] && diskBlocks[i].file === name) {
                    diskBlocks[i] = null;
                }
            }
            
            delete files[name];
            updateDiskDisplay();
            updateDirectoryTable();
            logStatus(`Fișier ${name} șters`, 'success');
        }
        
        // Extend file
        function extendFile() {
            const name = document.getElementById('extend-file-name').value;
            const extendBy = parseInt(document.getElementById('extend-size').value);
            
            if (!files[name]) {
                logStatus(`Fișierul ${name} nu există!`, 'error');
                return;
            }
            
            const fileClass = `file-${name.toLowerCase()}`;
            
            if (currentMethod === 'contiguous') {
                // Check if next blocks are free
                const file = files[name];
                const endBlock = file.start + file.length;
                
                let canExtend = true;
                for (let i = endBlock; i < endBlock + extendBy; i++) {
                    if (i >= TOTAL_BLOCKS || diskBlocks[i] !== null) {
                        canExtend = false;
                        break;
                    }
                }
                
                if (canExtend) {
                    for (let i = endBlock; i < endBlock + extendBy; i++) {
                        diskBlocks[i] = { file: name, class: fileClass };
                        file.blocks.push(i);
                    }
                    file.length += extendBy;
                    updateDiskDisplay();
                    updateDirectoryTable();
                    logStatus(`Fișier ${name} extins cu ${extendBy} blocuri`, 'success');
                } else {
                    logStatus(`Nu se poate extinde ${name} - blocuri ocupate sau end of disk!`, 'error');
                }
                
            } else if (currentMethod === 'linked') {
                // Find free blocks and link them
                const freeBlocks = [];
                for (let i = 0; i < TOTAL_BLOCKS; i++) {
                    if (diskBlocks[i] === null) freeBlocks.push(i);
                    if (freeBlocks.length === extendBy) break;
                }
                
                if (freeBlocks.length < extendBy) {
                    logStatus(`Nu există ${extendBy} blocuri libere!`, 'error');
                    return;
                }
                
                const file = files[name];
                
                // Update last block's pointer
                diskBlocks[file.last].next = freeBlocks[0];
                
                // Allocate new blocks
                for (let i = 0; i < freeBlocks.length; i++) {
                    const blockIdx = freeBlocks[i];
                    const nextBlock = i < freeBlocks.length - 1 ? freeBlocks[i + 1] : null;
                    diskBlocks[blockIdx] = { 
                        file: name, 
                        class: fileClass, 
                        next: nextBlock,
                        isPointer: true
                    };
                    file.blocks.push(blockIdx);
                }
                
                file.last = freeBlocks[freeBlocks.length - 1];
                
                updateDiskDisplay();
                updateDirectoryTable();
                logStatus(`Fișier ${name} extins cu ${extendBy} blocuri`, 'success');
                
            } else { // indexed
                const freeBlocks = [];
                for (let i = 0; i < TOTAL_BLOCKS; i++) {
                    if (diskBlocks[i] === null) freeBlocks.push(i);
                    if (freeBlocks.length === extendBy) break;
                }
                
                if (freeBlocks.length < extendBy) {
                    logStatus(`Nu există ${extendBy} blocuri libere!`, 'error');
                    return;
                }
                
                const file = files[name];
                
                // Update index block
                diskBlocks[file.indexBlock].pointers.push(...freeBlocks);
                
                // Allocate data blocks
                for (const blockIdx of freeBlocks) {
                    diskBlocks[blockIdx] = { file: name, class: fileClass };
                    file.blocks.push(blockIdx);
                    file.allBlocks.push(blockIdx);
                }
                
                updateDiskDisplay();
                updateDirectoryTable();
                logStatus(`Fișier ${name} extins cu ${extendBy} blocuri`, 'success');
            }
        }
        
        // Update disk display
        function updateDiskDisplay() {
            let usedCount = 0;
            
            for (let i = 0; i < TOTAL_BLOCKS; i++) {
                const block = document.getElementById(`block-${i}`);
                const data = diskBlocks[i];
                
                block.className = 'disk-block rounded flex items-center justify-center text-xs font-bold';
                
                if (data) {
                    block.classList.add(data.class);
                    if (data.isPointer && data.next !== null) {
                        block.classList.add('pointer');
                    }
                    if (data.isIndex) {
                        block.textContent = 'IDX';
                    } else {
                        block.textContent = i;
                    }
                    block.classList.add('allocation-animation');
                    usedCount++;
                } else {
                    block.classList.add('empty');
                    block.textContent = i;
                }
            }
            
            document.getElementById('used-blocks').textContent = usedCount;
        }
        
        // Update directory table
        function updateDirectoryTable() {
            const tbody = document.getElementById('directory-table');
            tbody.innerHTML = '';
            
            for (const [name, info] of Object.entries(files)) {
                const row = document.createElement('tr');
                row.className = 'directory-entry border-b border-gray-800';
                
                let col2, col3;
                
                if (currentMethod === 'contiguous') {
                    col2 = info.start;
                    col3 = info.length;
                } else if (currentMethod === 'linked') {
                    col2 = info.first;
                    col3 = info.last;
                } else {
                    col2 = info.indexBlock;
                    col3 = info.blocks.length;
                }
                
                const sizeKB = (currentMethod === 'indexed' ? info.blocks.length : info.blocks?.length || info.length) * 4;
                
                row.innerHTML = `
                    <td class="py-2 px-3">
                        <span class="inline-block w-3 h-3 rounded mr-2 disk-block file-${name.toLowerCase()}"></span>
                        File ${name}
                    </td>
                    <td class="text-center py-2 px-3 mono">${col2}</td>
                    <td class="text-center py-2 px-3 mono">${col3}</td>
                    <td class="text-center py-2 px-3 text-gray-400">${sizeKB} KB</td>
                `;
                
                tbody.appendChild(row);
            }
            
            if (Object.keys(files).length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">Niciun fișier</td></tr>';
            }
        }
        
        // Show block info
        function showBlockInfo(blockIdx) {
            const data = diskBlocks[blockIdx];
            if (!data) {
                logStatus(`Block ${blockIdx}: liber`, 'info');
            } else {
                let info = `Block ${blockIdx}: File ${data.file}`;
                if (data.isIndex) {
                    info += ` (INDEX → [${data.pointers.join(', ')}])`;
                } else if (data.next !== null && data.next !== undefined) {
                    info += ` → next: ${data.next}`;
                }
                logStatus(info, 'info');
            }
        }
        
        // Log status
        function logStatus(message, type = 'info') {
            const log = document.getElementById('status-log');
            const colors = {
                'info': 'text-gray-300',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-amber-400'
            };
            
            const entry = document.createElement('div');
            entry.className = colors[type];
            const time = new Date().toLocaleTimeString('ro-RO', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            entry.innerHTML = `<span class="text-gray-600 text-xs">[${time}]</span> ${message}`;
            log.insertBefore(entry, log.firstChild);
            
            // Keep only last 10 entries
            while (log.children.length > 10) {
                log.removeChild(log.lastChild);
            }
        }
        
        // Reset disk
        function resetDisk() {
            diskBlocks = new Array(TOTAL_BLOCKS).fill(null);
            files = {};
            updateDiskDisplay();
            updateDirectoryTable();
            logStatus('Disk resetat', 'info');
        }
    </script>
</body>
</html>
